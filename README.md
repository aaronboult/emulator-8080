# emulator-8080
An emulator for the Intel 8080 CPU written in Rust using the SDL2 library for graphics and the SDL2 Mixer library for audio.

## Building
1. Run `cargo build --release` in the root folder
2. Copy all `.dll` files in the root directory, `cpudiag.bin` and `LICENSE` to `./target/release`
3. Copy all game source folders, e.g. `space-invaders-source` to `./target/release`

## Support and Extending Support
Currently the only supported game is the 1978 version of Space Invaders.

To add support for additional games, follow the below process:
  1. Place all of the games source files into a folder in the root directory; name the folder accordingly
  
  2. Create a new rust file in the `./src/machine` directory. This file must contain the following 6 functions to be valid:
  
      - A draw function that takes a mutable reference to a `machine::Machine` struct. This function should read the video memory, accessible through `machine_reference.cpu.memory` and draw the stored image according to the given game's specification using the SDL2 canvas, accessible through `machine_reference.canvas`
      
      - A function to handle OUT instructions according to the given game's specification; this function takes a mutable reference to a `cpu::Processor8080` struct, a `u8` representing the port to be written to, a `u8` representing the value to write to the given port, a mutable reference to a `Vec<u8>` representing all of the ports and a mutable reference to a `Machine::AudioController` struct, used to play audio and manage volume
      
      - A function to handle IN instructions according to the given game's specification; this function takes a mutable reference to a `cpu::Processor8080` struct, a `u8` representing the port to be read from, a mutable reference to a `Vec<u8>` representing all of the ports and should return a `u8` that will be stored in the accumulator
      
      - A function to handle game interrupts according to the given game's specification; this function takes a mutable reference to a `machine::Machine` struct, and CPU interrupts can be generated by calling `machine_reference.cpu.generate_interrupt()`
      
      - A function to handle SDL2 key events; this function takes a mutable reference to a `machine::Machine` struct, and can manage volume using `machine_reference.audio_controller`
      
      - A setup function; this function takes a mutable reference to a `machine::SetupConfiguration` struct, and must assign the handler fields of the given struct to the functions created in this file. The setup function should also display game controls, load game files at the required offsets as specified by the game's specification by populating the `setup_config_reference.files` with `cpu::FileToLoad` structs. Audio should be loaded into the `setup_config_reference.audio_tracks` vector using `sdl2::mixer::Chunk::from_file(...)` method. Initial port values can be set by using `setup_config_reference.ports[...]`, and the game window can be modified by using `setup_config_reference.window`. The window title and size should both be set.
  
  3. In the `./src/machine.rs` file, you must add the file you previously created as a module, e.g. `mod my_added_game`, and within the implementation of a `new` function on the `Machine` struct, you must add your game to the `match` expression, setting value to be matched against `game_id` to be 1 greater than the previous, then simply call the `setup` function within `my_added_game` passing a mutable reference to the `setup_config`, e.g.:
  ```rust
  match game_id {

    0 => {

        space_invaders::setup(&mut setup_config);

    }, // Space Invaders

    1 => {

        my_added_game::setup(&mut setup_config);

    }, // My Added Game

    _ => panic!("Game ID is invalid"),
}
```

  4. Finally, in the `./src/main.rs` file you must increment the constant `NUMBER_OF_PROGRAMS_EMULATED` by 1, and then append another row to the `display_options()`, containing the name of the game you have added and the corresponding ID (this ID is the value that is matched against the `game_id` in `./src/machine.rs`, e.g.:
  ```rust
print!("\
Select one of the following by typing the corresponding ID

        Game ID     |     Game Name
    -----------------------------------
            0       |  Space Invaders
            1       |  My Added Game
\n\
:>> \
");
